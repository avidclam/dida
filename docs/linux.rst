.. rst3: filename: linux

Linux, разное
=============

Магия чисел
+++++++++++++++++++++



Виртуальные машины
***********************************

Полезна единая система номеров для виртуальных машин.

Например, используется сеть 192.168.68/24, IP-адреса виртуальных машин начинаются с 81, а имя хоста первой виртуалки: ``uno``. 

.. table:: Пример настройки параметров первой виртуальной машины:
   :widths: auto

   =================  ================================  ==========
   Название VM                      uno81               или vm81uno, например
   MAC-адрес                         0A:C0:A8:44:51:01  (т.е. 10:192:168:68:81:1)
   IP-адрес                            192.168.68.81
   Порт VNC-консоли             5981
   =================  ================================  ==========

Соображения по MAC-адресу:
    
    Чтобы MAC-адрес распознался как Locally Administered MAC Аddress, он должен начинаться с x2, x6, xA или xE. Далее октеты могут быть любыми. Удобно, чтобы они соответствовали IP-адресу. В последнем октете ставится единица, если сеть строится по правилу "один интерфейс --- один адрес", либо используются разные цифры для более хитрых настроек.

Нестандарт
********************

Время от времени появляется желание использовать недефолтные UID для пользователей и нестандартные номера портов сетевых служб (например, из соображений безопасности). 
По прошествии времени вся нумерация, естественно, забывается, и вспомнить, на какой порт был в итоге повешен sshd, бывает затруднительно.

Простой выход из положения --- считать UID административного пользователя (не root) магическим числом, базой нумерации. 

Пример: на группе машин административный пользователь ``resurepus`` имеет UID=23400.
Тогда если забылась вся нумерация, достаточно команды ``id``, чтобы вспомнить, что sshd располагается на порту 23422, служебный веб-сервер --- на 23480, и т.п.

Мало энтропии
+++++++++++++++++++++++++

Наиболее неприятный симптом недостатка энтропии в системе: невозможно войти по ssh пока не залогинишься с консоли.

Проверить текущий уровень энтропии можно командой::
    
    cat /proc/sys/kernel/random/entropy_avail

Принято считать, что если полученное число меньше 1000, то код, предполагающий работу со случайными числами и шифрованием, работает нестабильно или вообще не работает.

Выход из ситуации: необходимо установить ``rng-tools`` и обеспечить работу сервиса ``rngd``::
    
    systemctl enable rngd
    systemctl start rngd
    journalctl -u rngd

Часто еще устанавливают `haveged <http://www.issihosts.com/haveged>`_, но он не входит в стандартный набот пакетов RHEL/CentOS, и требует `EPEL <https://fedoraproject.org/wiki/EPEL>`_.

Диски и разделы
++++++++++++++++++++++++++++



Что происходит?
++++++++++++++++++++++++++++



Что это за устройство?
****************************************

Хотим, например, узнать параметры аппаратного сетевого интерфейса eth0. А вот::
    
    for f in $(find /sys/devices -name eth0); do udevadm info $f; done

Watch
*****

Довольно тривиальная команда, но почему-то все время забывается.
Допустим, нужно, запустив процесс, последить, какие файлы он добавляет в директорию.

Здесь нам поможет::

    watch tree <directory>

Bash
++++



Работа с фоновыми процессами
*****************************************************

::
    
    autosphinx -l &  # launch background job
    jobs  # list background jobs, add -l for PIDs
    fg %1  # put job #1 into foreground
    # Ctrl+Z: put foreground process on pause
    bg  # continue running process in the background
    kill -HUP %1  # send hangup to the process
    disown %1  # detach job from terminal

